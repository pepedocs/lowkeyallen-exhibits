# id
stuxnet-malware-2010

# title
Stuxnet - The Digital Weapon

# what
Stuxnet was a sophisticated computer worm discovered in 2010, designed to sabotage Iran's nuclear program by targeting Siemens industrial control systems. It was the first known malware designed to cause physical damage to industrial equipment, marking the beginning of cyber warfare era.

# impact
Demonstrated that cyber attacks could cause real-world physical damage, introducing the concept of cyber warfare. Changed international relations and military strategy, leading to new doctrines around digital weapons and nation-state cyber capabilities.

# when
2010

# category
Cyber Security

# language
C++

# codeSnippet
```cpp
/* Stuxnet SCADA targeting code (simplified reconstruction) */
#include <windows.h>
#include <stdio.h>

// Target Siemens Step7 PLC programming software
#define STEP7_PROCESS "s7otbxdx.exe"
#define CENTRIFUGE_FREQ_NORMAL 1064  // Normal centrifuge frequency (Hz)
#define CENTRIFUGE_FREQ_ATTACK 1410  // Attack frequency (Hz)

typedef struct {
    DWORD process_id;
    HANDLE process_handle;
    BOOL is_targeted_facility;
} PLCTarget;

// Check if we're in the target facility (Iranian nuclear plant)
BOOL IsTargetFacility() {
    // Check for specific Siemens configurations
    // and Iranian facility indicators
    char facility_id[256];
    GetEnvironmentVariable("FACILITY_ID", facility_id, 256);
    
    // Look for specific frequency converters (Fararo Paya and Vacon)
    if (strstr(facility_id, "NATANZ") || 
        CheckFrequencyConverters() &&
        CountCentrifuges() > 984) {  // Natanz had ~984 centrifuges
        return TRUE;
    }
    return FALSE;
}

// Main payload - modify centrifuge frequencies
void ExecutePayload() {
    if (!IsTargetFacility()) {
        return;  // Only execute at target
    }
    
    PLCTarget targets[32];
    int target_count = FindStep7Processes(targets, 32);
    
    for (int i = 0; i < target_count; i++) {
        // Inject into Step7 process
        if (InjectIntoProcess(targets[i].process_handle)) {
            
            // Phase 1: Record normal operations for 13 days
            RecordNormalOperations(13);
            
            // Phase 2: Gradually increase centrifuge speed
            for (int days = 0; days < 50; days++) {
                int frequency = CENTRIFUGE_FREQ_NORMAL + 
                               (days * (CENTRIFUGE_FREQ_ATTACK - CENTRIFUGE_FREQ_NORMAL) / 50);
                
                SetCentrifugeFrequency(frequency);
                
                // Hide the attack from operators
                if (IsOperatorPresent()) {
                    DisplayFakeNormalReadings();
                }
                
                Sleep(24 * 60 * 60 * 1000);  // Wait 24 hours
            }
            
            // Phase 3: Rapid speed variations to damage equipment
            for (int cycle = 0; cycle < 100; cycle++) {
                SetCentrifugeFrequency(CENTRIFUGE_FREQ_ATTACK);
                Sleep(15 * 60 * 1000);  // 15 minutes high speed
                
                SetCentrifugeFrequency(2);  // Near-stop
                Sleep(5 * 60 * 1000);   // 5 minutes low speed
            }
        }
    }
}

// Rootkit functionality to hide from detection
void InstallRootkit() {
    // Hook system calls to hide files and processes
    HookNtQueryDirectoryFile();
    HookNtQuerySystemInformation();
    
    // Install kernel driver with stolen certificates
    LoadSignedDriver("mrxnet.sys");  // Stuxnet's driver
}

// Self-destruct after June 24, 2012
void CheckKillDate() {
    SYSTEMTIME st;
    GetSystemTime(&st);
    
    if (st.wYear > 2012 || 
        (st.wYear == 2012 && st.wMonth > 6) ||
        (st.wYear == 2012 && st.wMonth == 6 && st.wDay > 24)) {
        
        SelfDestruct();
    }
}
```

# sourceLink
https://www.langner.com/stuxnet/

# expertExplanation
Stuxnet used four zero-day exploits and targeted specific Siemens Step7 software controlling centrifuges. It recorded normal operations for weeks, then gradually increased centrifuge speeds beyond safe limits while displaying fake normal readings to operators. The malware checked for specific configurations indicating Iranian nuclear facilities and would only activate its destructive payload in those environments. It used stolen digital certificates and sophisticated rootkit techniques to avoid detection.
